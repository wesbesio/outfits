<div id="outfit-form-container">
    <form {% if outfit and outfit.outid %}
              hx-put="{{ form_action }}"
          {% else %}
              hx-post="{{ form_action }}"
          {% endif %}
          hx-target="#main-content"
          hx-swap="innerHTML"
          enctype="multipart/form-data">

        {% if error %}
            <div class="alert alert-danger mb-md" style="color: #EF4444; background-color: #FEF2F2; border: 1px solid #FCA5A5; padding: 10px; border-radius: var(--border-radius-sm);">
                {{ error }}
            </div>
        {% endif %}

        <div class="form-group">
            <label for="name">Outfit Name:</label>
            <input type="text" id="name" name="name" value="{{ outfit.name if outfit else '' }}" required>
        </div>

        <div class="form-group">
            <label for="vendorid">Vendor (Optional):</label>
            <select id="vendorid" name="vendorid">
                <option value="">-- Select Vendor --</option>
                {% if vendors %}
                    {% for vendor_item in vendors %}
                        <option value="{{ vendor_item.venid }}" {% if outfit and outfit.vendorid == vendor_item.venid %}selected{% endif %}>
                            {{ vendor_item.name }}
                        </option>
                    {% endfor %}
                {% else %}
                    <option value="" disabled>No vendors available</option>
                {% endif %}
            </select>
        </div>

        <div class="form-group">
            <label for="description">Description (Optional):</label>
            <textarea id="description" name="description" rows="3">{{ outfit.description if outfit else '' }}</textarea>
        </div>

        <div class="form-group">
            <label for="notes">Notes (Optional):</label>
            <textarea id="notes" name="notes" rows="3">{{ outfit.notes if outfit else '' }}</textarea>
        </div>

        <div class="form-group">
            <label for="outfit-image-upload">Image (Max 5MB, JPEG/PNG/WEBP/GIF):</label>
            <input type="file" id="outfit-image-upload" name="image" accept="image/jpeg,image/png,image/webp,image/gif" class="form-control">
            {% if outfit and outfit.image %}
                <img id="outfit-image-preview" src="/api/images/outfits/{{ outfit.outid }}" alt="Current image" class="card-image mt-md" style="display: block; max-height: 200px; object-fit: contain; border-radius: var(--border-radius-sm);">
                <label class="mt-sm" style="display: flex; align-items: center; gap: var(--spacing-xs); font-weight: normal; cursor: pointer;">
                    <input type="checkbox" name="keep_existing_image" value="True" checked style="width: auto; height: auto; margin-right: var(--spacing-xs);"> Keep existing image
                </label>
            {% else %}
                <img id="outfit-image-preview" src="#" alt="Image preview" class="card-image mt-md" style="display: none; max-height: 200px; object-fit: contain; border-radius: var(--border-radius-sm);">
                <input type="hidden" name="keep_existing_image" value="False">
            {% endif %}
        </div>

        <div class="form-group">
            <label>Select Components for this Outfit:</label>
            <div id="component-checkboxes-container"
                 {% if outfit and outfit.outid %} 
                     hx-get="/api/outfits/components_list?outid={{ outfit.outid }}"
                     hx-trigger="load"
                     hx-swap="innerHTML"
                 {% endif %}>
                {% if outfit and outfit.outid %}
                    <p class="text-secondary text-center">Loading components...</p>
                {% else %}
                    <p class="text-secondary text-center">Save the outfit to enable adding components.</p>
                {% endif %}
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                {% if outfit and outfit.outid %}Update Outfit{% else %}Create Outfit{% endif %}
            </button>
            <a href="/outfits/" class="btn btn-outline" hx-get="/outfits/" hx-target="#main-content" hx-swap="innerHTML" hx-push-url="true">
                Cancel
            </a>
        </div>
    </form>
</div>
