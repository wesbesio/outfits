<!-- File: templates/components/detail_content.html -->
<!-- Revision: 1.1 - Content-only version of component detail template with improved outfits section -->

{% block content %}
<div class="container">
    <!-- Back Navigation -->
    <div class="nav-breadcrumb">
        <a href="/components" class="breadcrumb-link" 
           hx-get="/components" hx-target="#main-content" hx-push-url="true">
            ‚Üê Back to Components
        </a>
    </div>

    <!-- Component Detail Container -->
    <div class="detail-container" id="component-detail-container">
        <!-- View Mode -->
        <div id="component-view-mode">
            <div class="detail-header">
                <div class="detail-image-section">
                    <div class="detail-image" id="component-main-image">
                        {% if component.has_image %}
                            <img src="/api/images/component/{{ component.comid }}" 
                                 alt="{{ component.name }}" 
                                 class="component-image">
                        {% else %}
                            <div class="image-placeholder">
                                <span class="placeholder-icon">üß•</span>
                                <p class="placeholder-text">No image</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <div class="detail-info">
                    <h1 class="detail-title">{{ component.name }}</h1>
                    
                    <div class="detail-meta">
                        <div class="meta-item">
                            <span class="meta-label">Cost:</span>
                            <span class="meta-value component-cost">${{ component.cost }}</span>
                        </div>
                        {% if component.brand %}
                        <div class="meta-item">
                            <span class="meta-label">Brand:</span>
                            <span class="meta-value">{{ component.brand }}</span>
                        </div>
                        {% endif %}
                        {% if component.piece_name %}
                        <div class="meta-item">
                            <span class="meta-label">Type:</span>
                            <span class="meta-value">{{ component.piece_name }}</span>
                        </div>
                        {% endif %}
                        {% if component.vendor_name %}
                        <div class="meta-item">
                            <span class="meta-label">Vendor:</span>
                            <span class="meta-value">{{ component.vendor_name }}</span>
                        </div>
                        {% endif %}
                        <div class="meta-item">
                            <span class="meta-label">Status:</span>
                            <span class="meta-value">
                                <span class="status-badge {{ 'active' if component.active else 'inactive' }}">
                                    {{ 'Active' if component.active else 'Retired' }}
                                </span>
                            </span>
                        </div>
                    </div>

                    {% if component.description %}
                    <div class="detail-description">
                        <h3>Description</h3>
                        <p>{{ component.description }}</p>
                    </div>
                    {% endif %}

                    {% if component.notes %}
                    <div class="detail-description">
                        <h3>Notes</h3>
                        <p>{{ component.notes }}</p>
                    </div>
                    {% endif %}

                    <div class="detail-actions">
                        <button class="btn btn-primary" onclick="enterEditMode()">
                            <span>‚úèÔ∏è</span> Edit Component
                        </button>
                    </div>
                </div>
            </div>

            <!-- Used In Outfits Section -->
            <div class="outfits-section">
                <h2 class="section-title">Used in Outfits</h2>
                
                <div id="component-outfits" 
                     hx-get="/api/components/{{ component.comid }}/outfits"
                     hx-trigger="load"
                     hx-target="this"
                     hx-swap="innerHTML"
                     hx-indicator="#outfits-loading">
                    <div id="outfits-loading" class="loading-state">
                        <div class="spinner"></div>
                        <p>Loading outfits...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Mode (Hidden by default) -->
        <div id="component-edit-mode" class="hidden">
            <form id="component-edit-form" 
                  hx-put="/api/components/{{ component.comid }}"
                  hx-target="#component-detail-container"
                  hx-swap="outerHTML">
                
                <div class="edit-header">
                    <h2 class="edit-title">Edit Component</h2>
                    <div class="edit-actions">
                        <button type="button" class="btn btn-secondary" onclick="exitEditMode()">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <span>üíæ</span> Save Changes
                        </button>
                    </div>
                </div>

                <div class="edit-content">
                    <!-- Image Upload Section -->
                    <div class="form-group">
                        <label class="form-label">Component Photo</label>
                        <div class="image-upload-section">
                            <div class="current-image" id="current-component-image">
                                {% if component.has_image %}
                                    <img src="/api/images/component/{{ component.comid }}" 
                                         alt="{{ component.name }}" 
                                         class="current-image-preview">
                                    <button type="button" class="btn btn-small remove-image-btn"
                                            hx-delete="/api/components/{{ component.comid }}/image"
                                            hx-target="#current-component-image"
                                            hx-swap="innerHTML">
                                        Remove
                                    </button>
                                {% else %}
                                    <div class="no-image-placeholder">
                                        <span class="placeholder-icon">üì∑</span>
                                        <p>No image uploaded</p>
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="image-upload-container" 
                                 id="component-image-upload"
                                 data-upload-url="/api/components/{{ component.comid }}/upload-image">
                                <div class="upload-content">
                                    <span class="upload-icon">üìÅ</span>
                                    <p class="upload-text">
                                        <strong>Click to upload</strong> or drag and drop<br>
                                        <small>JPEG, PNG, WebP up to 5MB</small>
                                    </p>
                                </div>
                                <input type="file" 
                                       id="component-image-input" 
                                       accept="image/jpeg,image/png,image/webp"
                                       style="display: none;">
                            </div>
                        </div>
                    </div>

                    <!-- Basic Info -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="component-name" class="form-label">Component Name *</label>
                            <input type="text" 
                                   id="component-name" 
                                   name="name" 
                                   class="form-input" 
                                   value="{{ component.name }}" 
                                   required>
                        </div>
                        
                        <div class="form-group">
                            <label for="component-brand" class="form-label">Brand</label>
                            <input type="text" 
                                   id="component-brand" 
                                   name="brand" 
                                   class="form-input" 
                                   value="{{ component.brand or '' }}">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="component-cost" class="form-label">Cost *</label>
                            <input type="number" 
                                   id="component-cost" 
                                   name="cost" 
                                   class="form-input" 
                                   value="{{ component.cost }}" 
                                   min="0" 
                                   step="1" 
                                   required>
                        </div>
                        
                        <div class="form-group">
                            <label for="component-piece" class="form-label">Piece Type</label>
                            <select id="component-piece" 
                                    name="piecid" 
                                    class="form-select"
                                    hx-get="/api/pieces"
                                    hx-trigger="load"
                                    hx-target="this"
                                    hx-swap="innerHTML">
                                <option value="">Select piece type...</option>
                                <!-- Piece options loaded via HTMX -->
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="component-vendor" class="form-label">Vendor</label>
                        <select id="component-vendor" 
                                name="vendorid" 
                                class="form-select"
                                hx-get="/api/vendors"
                                hx-trigger="load"
                                hx-target="this"
                                hx-swap="innerHTML">
                            <option value="">Select vendor...</option>
                            <!-- Vendor options loaded via HTMX -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="component-description" class="form-label">Description</label>
                        <textarea id="component-description" 
                                  name="description" 
                                  class="form-textarea" 
                                  placeholder="Describe this component...">{{ component.description or '' }}</textarea>
                    </div>

                    <!-- Status -->
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <div class="radio-group">
                            <label class="radio-option {{ 'selected' if component.active }}">
                                <input type="radio" name="active" value="true" {{ 'checked' if component.active }}>
                                <span>Active</span>
                            </label>
                            <label class="radio-option {{ 'selected' if not component.active }}">
                                <input type="radio" name="active" value="false" {{ 'checked' if not component.active }}>
                                <span>Retired</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="component-notes" class="form-label">Notes</label>
                        <textarea id="component-notes" 
                                  name="notes" 
                                  class="form-textarea" 
                                  placeholder="Additional notes...">{{ component.notes or '' }}</textarea>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.component-cost {
    color: var(--primary-color);
    font-size: 1.5rem;
}

.component-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.outfits-section {
    padding: var(--spacing-xl);
    border-top: 1px solid #E5E7EB;
}

@media (max-width: 768px) {
    .detail-header {
        grid-template-columns: 1fr;
        gap: var(--spacing-lg);
    }
    
    .detail-meta {
        grid-template-columns: 1fr;
    }
    
    .edit-header {
        flex-direction: column;
        gap: var(--spacing-md);
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .image-upload-section {
        grid-template-columns: 1fr;
    }
    
    .detail-actions {
        justify-content: center;
    }
}
</style>

<script>
function enterEditMode() {
    document.getElementById('component-view-mode').classList.add('hidden');
    document.getElementById('component-edit-mode').classList.remove('hidden');
}

function exitEditMode() {
    document.getElementById('component-edit-mode').classList.add('hidden');
    document.getElementById('component-view-mode').classList.remove('hidden');
}

// Handle radio button styling
document.addEventListener('change', function(e) {
    if (e.target.type === 'radio') {
        const name = e.target.name;
        const radioOptions = document.querySelectorAll(`input[name="${name}"]`);
        radioOptions.forEach(option => {
            const label = option.closest('.radio-option');
            if (option.checked) {
                label.classList.add('selected');
            } else {
                label.classList.remove('selected');
            }
        });
    }
});
</script>
{% endblock %}