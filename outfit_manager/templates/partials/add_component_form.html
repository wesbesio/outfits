<div class="form">
    <h2 class="form-title">Add Component to "{{ outfit.name }}"</h2>
    
    {% if components %}
    <div class="component-selection">
        <p class="form-description">Select components to add to this outfit:</p>
        
        <div class="component-list">
            {% for component in components %}
            <div class="component-option" 
                 data-component-id="{{ component.comid }}">
                <div class="component-preview">
                    {% if component.image %}
                        <img src="/api/images/component/{{ component.comid }}?thumbnail=true" 
                             alt="{{ component.name }}" 
                             class="component-thumbnail">
                    {% else %}
                        <div class="component-placeholder">
                            <span class="placeholder-icon">ðŸ§¥</span>
                        </div>
                    {% endif %}
                </div>
                
                <div class="component-info">
                    <h4 class="component-name">{{ component.name }}</h4>
                    <div class="component-details">
                        {% if component.brand %}
                        <span class="component-brand">{{ component.brand }}</span>
                        {% endif %}
                        <span class="component-cost">${{ component.cost }}</span>
                    </div>
                </div>
                
                <div class="component-actions">
                    <button type="button" 
                            class="btn btn-primary btn-small add-component-btn"
                            hx-post="/api/outfits/{{ outfit.outid }}/components/{{ component.comid }}"
                            hx-target="#component-{{ component.comid }}"
                            hx-swap="outerHTML"
                            onclick="addComponentToOutfit({{ component.comid }})">
                        <span>âž•</span> Add
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="hideModal()">
                Done
            </button>
        </div>
    </div>
    
    {% else %}
    <div class="empty-selection">
        <div class="empty-content">
            <span class="empty-icon">ðŸ§¥</span>
            <h3>No Available Components</h3>
            <p>All your components are already in this outfit, or you haven't created any components yet.</p>
            
            <div class="empty-actions">
                <button type="button" class="btn btn-secondary" onclick="hideModal()">
                    Close
                </button>
                <button type="button" 
                        class="btn btn-primary"
                        hx-get="/forms/new-component"
                        hx-target="#modal-container .modal-content">
                    <span>âž•</span> Create Component
                </button>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<style>
.form-description {
    color: var(--text-secondary);
    margin-bottom: var(--spacing-lg);
    text-align: center;
}

.component-list {
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid #E5E7EB;
    border-radius: var(--radius-md);
    background: #F9FAFB;
}

.component-option {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    padding: var(--spacing-md);
    border-bottom: 1px solid #E5E7EB;
    background: white;
    transition: background-color var(--transition-fast);
}

.component-option:last-child {
    border-bottom: none;
}

.component-option:hover {
    background: var(--accent-color);
}

.component-preview {
    width: 60px;
    height: 60px;
    border-radius: var(--radius-md);
    overflow: hidden;
    flex-shrink: 0;
}

.component-thumbnail {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.component-placeholder {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--accent-color) 0%, #E0E7FF 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary-light);
}

.placeholder-icon {
    font-size: 1.5rem;
}

.component-info {
    flex: 1;
    min-width: 0;
}

.component-name {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-xs);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.component-details {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    font-size: 0.875rem;
}

.component-brand {
    color: var(--text-secondary);
    font-style: italic;
}

.component-cost {
    color: var(--primary-color);
    font-weight: 600;
}

.component-actions {
    flex-shrink: 0;
}

.empty-selection {
    text-align: center;
    padding: var(--spacing-2xl);
}

.empty-content h3 {
    color: var(--text-primary);
    margin-bottom: var(--spacing-sm);
}

.empty-content p {
    color: var(--text-secondary);
    margin-bottom: var(--spacing-lg);
}

.empty-actions {
    display: flex;
    gap: var(--spacing-md);
    justify-content: center;
}

.added-component {
    opacity: 0.6;
    pointer-events: none;
}

.added-component .add-component-btn {
    background: var(--success-color);
    color: white;
}

.added-component .add-component-btn span {
    content: "âœ“";
}

@media (max-width: 768px) {
    .component-option {
        flex-direction: column;
        text-align: center;
        gap: var(--spacing-sm);
    }
    
    .component-preview {
        width: 80px;
        height: 80px;
    }
    
    .component-details {
        justify-content: center;
    }
    
    .empty-actions {
        flex-direction: column;
        align-items: center;
    }
}
</style>

<script>
function addComponentToOutfit(componentId) {
    // Find the component option and mark it as added
    const componentOption = document.querySelector(`[data-component-id="${componentId}"]`);
    if (componentOption) {
        componentOption.classList.add('added-component');
        
        const button = componentOption.querySelector('.add-component-btn');
        if (button) {
            button.innerHTML = '<span>âœ“</span> Added';
            button.disabled = true;
        }
        
        // Show success message
        if (window.appUtils) {
            window.appUtils.showToast('Component added to outfit!', 'success');
        }
        
        // Auto-close modal after 2 seconds if all components are added
        setTimeout(() => {
            const remainingComponents = document.querySelectorAll('.component-option:not(.added-component)');
            if (remainingComponents.length === 0) {
                hideModal();
            }
        }, 2000);
    }
}

// Handle HTMX success responses
document.body.addEventListener('htmx:afterRequest', function(evt) {
    if (evt.detail.xhr.status === 200 && evt.detail.requestConfig.verb === 'post') {
        // Component was successfully added
        const url = evt.detail.requestConfig.path;
        const match = url.match(/\/components\/(\d+)$/);
        if (match) {
            const componentId = match[1];
            addComponentToOutfit(componentId);
        }
    }
});
</script>